<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <title>Document</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.all.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
  <script src="javascripts/script.js" defer></script>

  <script>
    $(document).ready(function () {
      $('.delete-button').on('click', function () {
        const movieId = $(this).data('movieid');
        Swal.fire({
          title: 'Are you sure?',
          text: 'You won\'t be able to revert this!',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'No, cancel!',
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
        }).then(async (result) => {
          if (result.isConfirmed) {
            await Swal.fire('Deleted!', 'Your file has been deleted.', 'success');
            window.location.href = `/${movieId}/delete-movie`;
          } else {
            Swal.fire('Cancelled', 'Your file is safe :)', 'info');
          }
        });
      });


      // realease date - set the maximum date to current date
      $('#releaseYear').prop('max', new Date().toISOString().split('T')[0]);

    });
  </script>
</head>

<body>
  <div class="mb-4">
    <header>
      <div class=" py-3 bg-primary ">
        <div> <a href="/">
            <h1 class="col-xl-12 col-lg-12 col-md-12 col-sm-12 my-0 text-white">Movie Details Management
              System
            </h1>
          </a></div>
      </div>
      <div class="d-flex justify-content-end w-100 text-right mt-2">
        <a class="details bg-primary p-1 rounded nav m-0 mr-3 d-inline-block" href="/add-movie">Add Movie</a>
      </div>
    </header>

    <main>
      <div class="px-0 table-responsive text-center">
        <table class="table table-bordered table-striped mt-5 ">
          <thead>
            <tr class="bg-secondary text-white">
              <th class="table-col">Title</th>
              <th>Genre</th>
              <th>Director</th>
              <th>Runtime(mins)</th>
              <th>Release Date/year</th>
              <th>Review Count</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <% if (records.length > 0) { %>
            <% records.forEach((element) => { %>
            <tr>
              <td class="table-col"><%= element.title %></td>
              <td><%= element.genre %></td>
              <td><%= element.director %></td>
              <td><%= element.runtime %></td>
              <td><%= element.release_date %></td>
              <td><%= element.dataValues.review_count %></td>
              <td class="text-center">
                <a href="/<%= element.movie_id %>/details
                  " class=" btn-primary py-0">View</a>
                <a href="/<%= element.movie_id %>/edit" class="btn-success py-0 edit-button">Edit</a>
                <a data-movieid="<%= element.movie_id %>" class="btn-danger py-0 delete-button">Delete</a></td>
            </tr>
            <% }) %>
            <% }else{%>
            <tr>
              <td colspan="7">No results found!!!</td>
            </tr>
            <%  } %>
          </tbody>
        </table>


      </div>
    </main>
  </div>

</body>

</html>